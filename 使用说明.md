# DGSS 区域地质调查野外记录簿一键整理工具

## 软件简介

本工具专为中国地质调查局 DGSS 软件用户设计，用于自动化处理野外记录簿文档。通过现代化的图形界面，您可以一键完成从格式化到分册合并的全部流程，大幅提升工作效率。

**开发单位**：浙江省宁波地质院 基础地质调查研究中心
**开发者**：丁正鹏
**联系方式**：zhengpengding@outlook.com

---

## 主要功能

### 1. 🚀 智能自动化

**一键全自动运行**（推荐使用）

自动按顺序执行以下四个步骤，无需人工干预：

- 步骤 1：格式化文档
- 步骤 2：提取素描图
- 步骤 3：插入素描图
- 步骤 4：分册合并

### 2. 🛠 分步操作

如需单独执行某个步骤，可使用分步操作功能：

#### 步骤 1：格式化文档 (Format)

- **功能**：对 DGSS 导出的原始 Word 文档进行格式化处理
- **输入**：`word/DGSS导出报告` 文件夹中的原始文档
- **输出**：`word/重新排版的报告` 文件夹
- **处理内容**：
  - 统一文档样式和格式
  - 设置标题层级
  - 调整段落间距
  - 文本替换（如"界线描述"→"点上界线描述"）

#### 步骤 2：提取素描图 (Extract)

- **功能**：从项目文件夹中提取素描图并生成独立文档
- **输入**：各路线项目文件夹中的 `素描图` 子文件夹
- **输出**：`word/素描图汇总` 文件夹
- **处理内容**：
  - 自动定位素描图文件夹
  - 提取所有 PNG 格式图片
  - 为每张图片添加路线编号标题
  - 生成独立的素描图文档

#### 步骤 3：插入素描图 (Insert)

- **功能**：将素描图文档插入到格式化后的报告中
- **输入**：格式化后的报告 + 素描图文档
- **输出**：`word/报告-已插入素描图` 文件夹
- **处理内容**：
  - 在"路线自检"部分之后插入素描图
  - 保持正文两栏布局
  - 素描图采用单栏显示
  - 避免图片重复

#### 步骤 4：分册合并 (Merge)

- **功能**：将多个路线报告合并成分册
- **输入**：已插入素描图的完整版报告
- **输出**：`word/分册` 文件夹
- **处理内容**：
  - 按指定规则分册
  - 添加封面页和目录页
  - 统一页码编号
  - 生成最终的分册文档

### 3. ⚙️ 分册设置

提供三种分册模式：

#### 默认模式

- 每册包含 12 条路线
- 最后一册可能少于 12 条

#### 指定路线模式

- 自定义每册路线数量
- 可选：12 条/册、15 条/册、20 条/册
- 或手动输入其他数量

#### 指定总册模式

- 指定最终分成几册
- 可选：3 册、5 册、10 册
- 或手动输入其他数量
- 系统自动平均分配路线

---

## 使用步骤

### 前提条件

1. **文件夹结构**：在您的“野外手图”工作目录新建一个 `word` 文件夹，`word` 文件夹中 `DGSS导出报告文件夹。`
2. **原始数据**：`野外手图/word/DGSS导出报告` 文件夹中已存放 DGSS 导出的原始 野外路线电子手簿的全部Word 文档
3. **项目文件**：各路线的项目文件夹位于上级目录，且包含 `素描图` 子文件夹

### 标准工作流程

#### 方式一：一键全自动运行（推荐）

1. 双击运行 `野外手图/word/DGSS野外记录簿工具.exe`
2. 点击绿色按钮 **"一键全自动运行 (推荐)"**
3. 在分册设置区选择您需要的分册模式：
   - 默认：每册 12 条路线
   - 指定路线：自定义每册路线数
   - 指定总册：自定义总册数
4. 观察运行日志，等待所有步骤完成
5. 在 `野外手图/word/分册` 文件夹中查看最终成果

#### 方式二：分步执行

如果需要在某个步骤后检查结果，可按顺序执行各步骤：

1. 点击 **"1. 格式化文档 (Format)"**
   - 完成后，检查 `word/重新排版的报告` 文件夹
2. 点击 **"2. 提取素描图 (Extract)"**
   - 完成后，检查 `word/素描图汇总` 文件夹
3. 点击 **"3. 插入素描图 (Insert)"**
   - 完成后，检查 `word/报告-已插入素描图` 文件夹
4. 设置分册选项后，点击 **"4. 分册合并 (Merge)"**
   - 完成后，检查 `word/分册` 文件夹

---

## 输出文件说明

### 文件夹结构

```
野外手图/word/
├── DGSS导出报告/           # 原始输入文件
├── 重新排版的报告/          # 步骤1输出：格式化后的文档
├── 素描图汇总/             # 步骤2输出：素描图文档
├── 报告-已插入素描图/       # 步骤3输出：完整版报告
└── 分册/                   # 步骤4输出：最终分册文档
```

### 文件命名规则

- 格式化后的文档：`L0001_formatted.docx`
- 素描图文档：`L0001_素描图.docx`
- 完整版报告：`L0001_完整版.docx`
- 分册文档：`野外手图_第1册_L0001-L0012.docx`

---

## 注意事项

### 1. 文件路径

- ⚠️ **重要**：工作目录路径中不要包含空格或特殊字符
- 建议将项目放在简短路径下，如 `D:\地质调查\项目名\`

### 2. 文档格式

- 输入文档必须是 `.docx` 格式（Word 2007 及以上）
- 不支持 `.doc` 老格式

### 3. 素描图要求

- 仅支持 PNG 格式图片
- 图片应位于各路线项目文件夹的 `素描图` 子文件夹中
- 确保图片文件名不包含特殊字符

### 4. 运行环境

- 建议在处理大量文档时关闭其他 Word 程序
- 确保有足够的磁盘空间（建议至少 1GB 可用空间）

### 5. 数据备份

- 建议在运行前备份原始数据
- 软件不会修改 `DGSS导出报告` 文件夹中的原始文件

---

## 常见问题

### Q1：程序运行时提示找不到文件？

**A**：请检查：

1. `word/DGSS导出报告` 文件夹是否存在且包含文档
2. 路线项目文件夹是否在正确位置
3. 文件路径是否包含中文或特殊字符导致的编码问题

### Q2：素描图没有被正确提取？

**A**：请确认：

1. 素描图文件夹名称是否为"素描图"
2. 图片格式是否为 PNG
3. 项目文件夹结构是否正确

### Q3：分册合并失败？

**A**：可能原因：

1. 路线数量太少（少于设定的每册路线数）
2. Word 文档损坏或格式异常
3. 检查日志中的具体错误信息

### Q4：程序运行很慢？

**A**：这是正常现象，原因：

1. Word 文档处理本身耗时较长
2. 素描图插入需要处理大量图片
3. 建议在运行时不要操作其他 Word 文档

### Q5：如何更换分册设置？

**A**：

1. 在运行步骤4之前，在"分册设置"区域选择模式
2. 如果已经合并，可删除 `分册` 文件夹后重新运行步骤4

### Q6：运行过程中可以中断吗？

**A**：

- 不建议在运行过程中强制关闭程序
- 如需中断，可直接关闭程序窗口
- 已生成的中间文件不会被删除，可以从中断处继续

### Q7：两个版本的 exe 有什么区别？

**A**：

- **PyInstaller 版本**（`dist/DGSS野外记录簿工具.exe`）：

  - 启动稍慢
  - 兼容性更好
  - 文件体积较大
- **Nuitka 版本**（`DGSS野外记录簿工具-Nuitka.exe`）：

  - 启动更快
  - 运行性能更优
  - 需要 C++ 运行库支持

建议优先使用 Nuitka 版本，如遇问题再尝试 PyInstaller 版本。

---

## 技术支持

如遇到其他问题或需要定制化功能，请联系：

**丁正鹏**
邮箱：zhengpengding@outlook.com
单位：浙江省宁波地质院 基础地质调查研究中心

---

## 更新日志

### v1.0 (2025-11-25)

- ✅ 全新 PyQt6 图形界面
- ✅ 一键全自动运行功能
- ✅ 支持分步操作
- ✅ 多种分册模式
- ✅ 实时运行日志显示
- ✅ 同时提供 PyInstaller 和 Nuitka 两个版本

---

**感谢使用本工具！如果觉得好用，欢迎扫描界面右下角二维码请作者喝杯咖啡 ☕**
